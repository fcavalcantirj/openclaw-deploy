{
  "category": "setup",
  "description": "Run Claude Code on VM to install and configure OpenClaw Gateway",
  "steps": [
    "Load instance metadata from instances/{name}/metadata.json",
    "Retrieve Anthropic API key from secure storage",
    "SSH to VM as openclaw user: `ssh root@{ip} 'su - openclaw'`",
    "Set ANTHROPIC_API_KEY environment variable",
    "Run Claude Code with setup prompt: `ANTHROPIC_API_KEY={key} claude --print \"$(cat /home/openclaw/setup-openclaw.md)\"`",
    "Capture Claude Code output for logging",
    "Check for errors in output: look for 'error', 'failed', 'could not'",
    "If errors: parse error, attempt recovery or report to user",
    "Verify OpenClaw installed: `ssh openclaw@{ip} 'openclaw --version'`",
    "Verify Gateway running: `ssh openclaw@{ip} 'openclaw gateway status'`",
    "Verify config exists: `ssh openclaw@{ip} 'cat ~/.openclaw/openclaw.json'`",
    "Update metadata.json: status=openclaw-installed, openclaw_version={version}"
  ],
  "passes": false,
  "prerequisite": "04-bootstrap-vm",
  "inputs": ["instance_name"],
  "outputs": ["OpenClaw installed", "Gateway running", "Config created"]
}
