# openclaw-deploy Progress

## 2026-02-14: Install amcp-protocol CLI on VM during master-setup.sh
- Added Step 2b to scripts/master-setup.sh: idempotent `npm install -g @amcp/cli`
- Placed after Node 22 install (Step 2) and before user creation (Step 3)
- Idempotent: checks `command -v amcp` before installing
- Logs version after install
- bash -n syntax check passes

## 2026-02-14: Install proactive-amcp on VM during master-setup.sh
- Added Step 2c to scripts/master-setup.sh after amcp-protocol CLI (Step 2b)
- Primary install via `clawhub install proactive-amcp`, fallback to `npm install -g proactive-amcp`
- Idempotent: checks `command -v proactive-amcp` before installing
- Verifies with `proactive-amcp --help` and logs version
- bash -n syntax check passes, file at 541 lines (under 800 limit)

## 2026-02-14: Replace fake identity creation with 'amcp identity create'
- Removed sha256(seed) identity generation from Step 7 of master-setup.sh
- Removed direct cat > identity.json heredoc that embedded secrets (pinata_jwt, parent_bot_token, etc.)
- Replaced with: `amcp identity create --seed "$AMCP_SEED" --instance "$INSTANCE_NAME" --out "$AMCP_IDENTITY"`
- Added validation: `amcp identity validate --file "$AMCP_IDENTITY"` with fail on invalid
- Idempotent: skips creation if identity already exists and validates
- Extracts AID from `amcp identity validate --json` for logging
- grep confirms zero sha256sum calls remain in scripts/
- bash -n syntax check passes, file still at 541 lines

## 2026-02-14: Replace embedded watchdog with 'proactive-amcp install --watchdog-interval'
- Removed ~120 lines of embedded watchdog script from Step 9 of master-setup.sh
- Removed embedded cron setup for watchdog
- Replaced with: `proactive-amcp install --watchdog-interval 120` with service/port/notify flags
- Verifies watchdog is active via systemd timer or cron file check
- bash -n syntax check passes, file reduced from 541 to 432 lines

## 2026-02-14: Replace embedded checkpoint with 'proactive-amcp install --checkpoint-schedule'
- Removed ~60 lines of embedded checkpoint script from Step 10 of master-setup.sh
- Removed embedded cron setup and Pinata upload logic
- Replaced with: `proactive-amcp install --checkpoint-schedule "$CHECKPOINT_CRON"`
- Kept human-readable intervalâ†’cron conversion (case statement)
- bash -n syntax check passes, file reduced from 432 to 381 lines

## 2026-02-14: Move secrets to proactive-amcp config
- Added `proactive-amcp config set` calls after AMCP identity creation in Step 7
- Secrets stored: pinata_jwt, parent_bot_token, parent_chat_id, instance_name
- All stored in ~/.amcp/config.json via proactive-amcp (not in identity.json)
- Each call is non-fatal (|| log warning) to avoid blocking deploy on config issues
- bash -n syntax check passes, file at 389 lines
